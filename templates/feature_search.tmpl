[% 
    INCLUDE header.tmpl 
    title='Feature Search'
    no_link='feature_search'
    help_anchor='feature_search'
%]
<h1>Feature Search</h1>

<p>
<form>
<table>
    <tr>
        <td>Feature names*:</td>
        <td>Restrict species:</td>
        <td>Restrict feature types:</td>
        <td>Search field:</td>
    </tr>

    <tr>
        <td valign="top">
            <textarea name="features" rows="5" cols="20">[% apr.param('features') %]</textarea>
        </td>

        <td valign="top">
            <select name="species_aid" size="5" multiple>
                <option value="-1">--All Species--</option>
                [% FOREACH s=species %]
                    <option value="[% s.species_aid %]"[% IF species_lookup.${s.species_aid} %] selected[% END %]>[% s.species_name %]</option>
                [% END %]
            </select>
        </td>

        <td valign="top">
            <select name="feature_type_aid" size="5" multiple>
                <option value="-1">--All Feature Types--</option>
                [% FOREACH ft=feature_types %]
                    <option value="[% ft.feature_type_aid %]"[% IF feature_type_lookup.${ft.feature_type_aid} %] selected[% END %]>[% ft.feature_type %]</option>
                [% END %]
            </select>
        </td>

        <td valign="top">
            <select name="search_field">
                <option value="both"[% IF apr.param('search_field')=='both'; 'selected'; END %]>Both</option>
                <option value="feature_name"[% IF apr.param('search_field')=='feature_name'; 'selected'; END %]>Feature Name</option>
                <option value="alternate_name"[% IF apr.param('search_field')=='alternate_name'; 'selected'; END %]>Alt. Name</option>
            </select>
        </td>
    </tr>

    <tr>
        <td colspan="4" align="center">
            <input type="hidden" name="order_by" value="[% apr.param('order_by') %]">
            <input type="submit" name="submit" value="Submit">&nbsp;
            <input type="reset"  name="reset"  value="Reset">
        </td>
    </tr>
</table>
</form>

<small>
*<em>Separate multiple names with commas or whitespace.
Use &quot;*&quot; or &quot;%&quot; for wildcards.
</em></small>

<p>
[% IF apr.param('features') %]
    [% IF search_results.size %]
        [% SET i=0 %]
        <table border="0" width="100%">
            <tr>
                <td colspan="8" align="center">
                    [% SET pager_url="/cmap/feature_search?features=${apr.param('features')}&order_by=${apr.param('order_by')}&species_aids=${apr.param('species_aids')}&feature_type_aids=${apr.param('feature_type_aids')}" %]
                    [% PROCESS pager.tmpl %]
                </td>
            </tr>
            <tr>
                <th><a href="feature_search?features=[% apr.param('features') | uri %];order_by=feature_name;search_field=[% apr.param('search_field') %];species_aids=[% apr.param('species_aids') %];feature_type_aids=[% apr.param('feature_type_aids') %]">Feature Name</a></th>
                <th><a href="feature_search?features=[% apr.param('features') | uri %];order_by=feature_type;search_field=[% apr.param('search_field') %];species_aids=[% apr.param('species_aids') %];feature_type_aids=[% apr.param('feature_type_aids') %]">Feature Type</a></th>
                <th><a href="feature_search?features=[% apr.param('features') | uri %];order_by=species_name;search_field=[% apr.param('search_field') %];species_aids=[% apr.param('species_aids') %];feature_type_aid=[% apr.param('feature_type_aids') %]">Species</a></th>
                <th><a href="feature_search?features=[% apr.param('features') | uri %];order_by=map_set_name;search_field=[% apr.param('search_field') %];species_aids=[% apr.param('species_aids') %];feature_type_aids=[% apr.param('feature_type_aids') %]">Map Set</a></th>
                <th><a href="feature_search?features=[% apr.param('features') | uri %];order_by=map_name;search_field=[% apr.param('search_field') %];species_aids=[% apr.param('species_aids') %];feature_type_aids=[% apr.param('feature_type_aids') %]">Map Name</a></th>
                <th><a href="feature_search?features=[% apr.param('features') | uri %];order_by=alternate_name;search_field=[% apr.param('search_field') %];species_aids=[% apr.param('species_aids') %];feature_type_aids=[% apr.param('feature_type_aids') %]">Alt. Name</a></th>
                <th><a href="feature_search?features=[% apr.param('features') | uri %];order_by=start_position;search_field=[% apr.param('search_field') %];species_aids=[% apr.param('species_aids') %];feature_type_aids=[% apr.param('feature_type_aids') %]">Position</a></th>
                <th>&nbsp;</th>
                <th>&nbsp;</th>
            </tr>
      
            [% FOREACH r=search_results %]
                <tr [% IF i % 2 == 0 %] class='maptitle' [% END %]>
                    <td>[% r.feature_name %]</td>
                    <td>[% r.feature_type %]</td>
                    <td>[% r.species_name %]</td>
                    <td><a href="map_set_info?map_set_aid=[% r.map_set_aid %]">[% r.map_set_name %]</a></td>
                    <td>[% r.map_name %]</td>
                    <td>[% r.alternate_name %]</td>
                    <td align="right">
                        [% r.start_position %][% IF r.stop_position >= r.start_position %]-[% r.stop_position %][% END %]
                    </td>
                    <td>
                        <b>[</b>&nbsp;<a href="/cmap/viewer?ref_map_set_aid=[% r.map_set_aid %];ref_map_aid=[% r.map_aid %];highlight=[% r.feature_name %]">View&nbsp;on&nbsp;Map</a>&nbsp;<b>]</b>
                    </td>
                    <td>
                        <b>[</b>&nbsp;<a href="feature?feature_aid=[% r.feature_aid %]">Feature&nbsp;Details</a><b>&nbsp;]</b>
                    </td>
                </tr>    
                [% SET i=i+1 %]
            [% END %]
        </table>
  
    [% ELSE %]
  
        No records found.
  
    [% END %]
[% END %]

[% page.end_body OR '</body>' %]
</html>
